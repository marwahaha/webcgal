<!DOCTYPE html>
<html>
<head>

<link rel="stylesheet" type="text/css" href="../../assets/stylesheet1.css">
<link rel="stylesheet" href="../../assets/codeEdit.css"/>

<script src="../../assets/jquery.js"></script>
<script src="../../assets/paper.js"></script>
<script src="../../assets/codemirror.js"></script>
<script src="../../assets/scripts.js"></script>    
    
</head>
<body>

<div id="nav">
    <a href="/">
        <!--          <h1>web-cgal</h1>-->
            <img id="logo" width ="100px" height ="100px" src="../../logo.svg"/>
    </a>

  <ul class="menu-root">
    <li><a data-default="true" href="/">Home</a>
    </li>
</ul>
  <ul class = "menu-root">
        <li class=""><a href="/index.html#features" class="">Features</a>  
        </li>
      
        <li class=""><a href="/index.html#browsersupport" class="">Browser support</a>
        </li>    
    </ul>
    
    <ul class = "menu-root">
        <li><a class="active" href="/playground.html">Playground</a>
        </li>
     </ul>
    
    <ul class="menu-root">
        <li><a href="/examples" class="">Examples</a>
        </li>
    </ul>
    
    
</div>
    
    <article>
        
<!--
<pre class="code" start="3">
    var myPath = new Path();
    myPath.add(myPoint);
</pre>
-->

<!--        <div class="paperscript">-->        
<div class="paperscript split">  
    
<div class="canvas up">
    <div class="left-div">
        <canvas width="892px" height="420px" id="canvas-1"></canvas>
    </div>
    <div class = "right-div" id="console">
    </div>
</div>
    
    
<div class="buttons">
<div class="button run">Source</div>
</div>
<script type="text/paperscript" canvas="canvas-1">
    
paper.settings.applyMatrix = false; 
project.activeLayer.transform( new Matrix(1,0,0,-1,view.center.x, view.center.y) );


var colors = ['red', 'blue', 'yellow', 'magenta', 'green'];
var drawables = [], segment = null, path = null, polPoint = null, polygon = null;
var hitOptions = {segments: true, fill: true, stroke: true, tolerance: 10};

function onMouseMove(event) { 
	project.activeLayer.selected = false;
    //if (event.item)
      //  event.item.bringToFront();
}

function onMouseDown(event) { 

    segment = path = polPoint =  null;
    
	var hitResult = project.hitTest(event.point, hitOptions);
    if (hitResult){                       //console.log(event.item.name)
            
        if (event.item.name.startsWith('polygonPoint'))
            polPoint = event.item;
        else if(event.item.name.startsWith('polygon'))
            path = hitResult.item;
        else if (hitResult.type == 'segment')
            segment = hitResult.segment;
    }
}

function onMouseDrag(event) {     
    if (segment)
		segment.point += event.delta;
	else if (path)
        {
            polygon.changePosition(event.delta * [1, -1]);
        }
    if (polPoint)
        polygon.changePosition2(polPoint, event.delta * [1, -1]);
 }

////////////////////////////////////     Visual Part      ///////////////////////////////

function clearDrawables(){
    for(i=0; i<drawables.length; i++) // it is for lines, circles, texts etc.
        drawables[i].remove();
    PolygonPoint.counter = 0;
}

Array.prototype.clear = function() {
  while (this.length) 
    this.pop();
};


//////////////////////////////////////  Classes  ////////////////////////////////////////

function Polygon(name){

    //if ((typeof Polygon.id == 'undefined'))
      //  Polygon.id = 0;
    
    this.name = name;
    this.points = new Object();
    this.path = null;
    var tempObj = this;
    
    this.addPoint = function(p){
        var polPoint = new PolygonPoint(p);
        tempObj.points['polygonPoint_' + Object.keys(tempObj.points).length] = polPoint;
    }
    
    this.changePosition = function(delta){
        for (var i in tempObj.points) 
            tempObj.points[i].pos += delta;     
        tempObj.draw();
    }
    
    this.changePosition2 = function(polPoint, delta){
        tempObj.points[polPoint.name].pos += delta;    
        tempObj.draw();
    }
    
    this.draw = function(){ // silip tekrar cizdirir
    
        clearDrawables();
        
        for (var i in tempObj.points)           //for(var i=0; i<tempObj.points.length; i++) // this is array version
            tempObj.points[i].draw(i);
            
        tempObj.path = new Path({name: 'polygon_'+this.name, fillColor: 'white', strokeColor: 'black', strokeWidth: 2});
        tempObj.path.sendToBack();
        tempObj.path.closed = true;
        
        for (var i in tempObj.points) 
            tempObj.path.add(tempObj.points[i].pos);
        
        drawables.push(tempObj.path);
    };
    
    this.sort = function(){
        tempObj.points.sort(function(a, b) {return a.point.x - b.point.x;});
    }
};

function PolygonPoint(p){

    this.pos = p;
    this.path = null;
    
    var tempObj = this;
    
    this.draw = function(id){
        drawables.push(new PointText({ point: tempObj.pos + [5, -5], fontSize: '16px', fillColor: 'black', content: ' '+ parseInt(id.split('_')[1])}));
        
        tempObj.path = new Path.Circle({ name: id, center: tempObj.pos, radius: 5, fillColor: 'black'});
        drawables.push(tempObj.path);
    };
    
    this.toString = function ToString() {
        return ''+tempObj.pos;  
    };
    
    return this;
};

function createRandomPolygon(){ 

    var sel = Math.floor(Math.random() * 3)
    var polygons = [
                    [[350.5,104],[300.5,231],[326.5,359],[236.5,335],[37.5,194],[181.5,161],[257.5,57]],
                    [[401.5,104],[450.5,246],[386.5,379],[236.5,335],[97.5,194],[287.5,222],[257.5,57]],
                    [[432.5,100],[481.5,242],[417.5,375],[267.5,331],[128.5,190],[200.5,90],[288.5,53]]
                   ];
                              
    var pols = polygons[sel];                
    var polygon = new Polygon('random');
    
    for(var k=0; k < pols.length; k++)
        polygon.addPoint(new Point(pols[k]));
    
    return polygon;
}

polys = project.importSVG(document.getElementById("polygons"));
for(var t=0; t<polys.children.length; t++)
    polys.children[t].visible = false;

function createPolygon(str, position, scaleFactor ){ 
    
    var web = polys.children[str];
    if(typeof web == 'undefined')
    {
        alert('not defined polygon')
        return;
    }
    
    web.visible = false;
    web.style = {fillColor: 'white', strokeColor: 'black', strokeWidth: 2}

    web.position = position || [250, 210];
    web.scale(scaleFactor || 1);

    var polygon = new Polygon(str);

    for(var k=0; k < web.children[0].segments.length; k++)
    {
        var p = new Point(web.children[0].segments[k].point);
        polygon.addPoint(p);
    }
    
    return polygon;
}


function createCodeMirror2(place, options, source) {
	return new CodeMirror(place, $.extend({}, {
		mode: 'javascript',
		tabSize: 4, indentUnit: 2, readOnly: true,
		value: source,
	}, options));
}

logStr = '';
function print(str){
    logStr = logStr.concat(str+'\n');
    
    var place = document.getElementById("console");
    $(place.childNodes[0]).remove()
    editor = createCodeMirror2(place, {}, logStr);   
}

function clear(){
    logStr = '';
    $(document.getElementById("console").childNodes[0]).remove()
}

var origin = new Point(0, 0);

function convertToRealCoord(p){
    var temp = p.clone();
    temp *= 60;
    temp += new Point(0, 0);
    //temp.y = 600 - temp.y;
    
    return temp;
}

function drawCoordinateSystem(){ 
    new Path.Line({name: 'x-coord', from: [-400, origin.y], to:[892, origin.y], strokeColor:'black', strokeWidth: 2})
    new Path.Line({name: 'y-coord', from: [origin.x, -400], to:[origin.x, 420], strokeColor:'black', strokeWidth: 2})
    
    for(i = -7; i <= 10; i++)
       new Path.Line({name: 'coord', from: convertToRealCoord(new Point(-7, i)), to: convertToRealCoord(new Point(10, i)), strokeColor:'black', strokeWidth: 1, dashArray: [1,2]})
 
    for(i = -7; i <= 10; i++)
       new Path.Line({name: 'coord', from: convertToRealCoord(new Point(i, -7)), to: convertToRealCoord(new Point(i, 7)), strokeColor:'black', strokeWidth: 1, dashArray: [1,2]})  
}

if(logStr.length == 0)
    clear();





//end-script
drawCoordinateSystem();

polygon = createRandomPolygon(); // first create a random polygon, then modify by dragging
polygon = createPolygon('square'); // first create a random polygon, then modify by dragging

//polygon.sort();
polygon.draw();

function onMouseMove(){
	clear();
	for (var i in polygon.points)
		print(i+": " + polygon.points[i])
}

//dd = createPolygon('square')
//dd.draw()
//dd.translate([150,0])

print(project.activeLayer.matrix);


// end of script

</script>

   
</div>
        
</article>    

<svg id = "polygons" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="900" height="5" visibility="hidden">

    <g id="star">    
        <path d="M 333.547 110.616 L 376.019 223.374 L 505.349 225.806 L 402.268 297.927 L 439.726 412.188 L 333.547 344.003 L 227.368 412.188 L 264.826 297.927 L 161.745 225.806 L 291.075 223.374 Z" data-bx-shape="star 333.547 277.321 180.643 166.705 0.4 5 1@f58dba71" style="fill: none; stroke: rgb(0, 0, 0); stroke-width: 2;"></path>
    </g>
    
    <g id="square">
        <path d="M 150.596 179.275 H 377.188 V 405.867 H 150.596 V 179.275 Z" data-bx-shape="rect 150.596 179.275 226.592 226.592 0 0 0 0 1@02fc28bb" style="fill: none; stroke: rgb(0, 0, 0); stroke-width: 2"></path>
    </g>

    <g id="triangle_set">
        <path d="M 403.809 180 L 488.935 380 L 574.062 180 L 654.651 380 L 735.305 180 L 884.509 510  L 99.797 510 L 249.001 180.086 L 326.437 380 Z" style="fill: none; stroke-width: 2" data-bx-origin="0 Infinity"></path>
    </g>
    
    <g id="arbitrary1" >
        <path d="M 358.79 225.54 L 427.471 273.365 L 369.637 327.132 L 447.776 338.998 L 409.174 452.863 L 371.688 452.863 L 322.828 359.203 L 273.968 452.863 L 238.557 452.863 L 204.321 351.875 L 287.419 325.559 L 218.357 274.69 L 291.344 223.866 L 325.42 304.555 Z" style="fill: none; stroke: rgb(0, 0, 0); stroke-width: 2;" data-bx-origin="0 0"></path>
    </g>
    
</svg>
    
</body>

<script>

//function createCodeMirror2(place, options, source) {
//	return new CodeMirror(place, $.extend({}, {
//		mode: 'javascript',
//		tabSize: 4, indentUnit: 4, readOnly: true,
//		value: source.match(
//			// Remove first & last empty line
//			/^\s*?[\n\r]?([\u0000-\uffff]*?)[\n\r]?\s*?$/)[1]
//	}, options));
//}
//
//var deneme = `var pols = polygons[sel];                
//var polygon = new Polygon();
//`;    
//    
//var place = document.getElementById("console");
//editor = createCodeMirror2(place, {}, deneme);   
//    
//    
   
    
</script>


</html>

