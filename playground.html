<!DOCTYPE html>
<html>
<head>

<link rel="stylesheet" type="text/css" href="../../assets/stylesheet1.css">
<link rel="stylesheet" href="../../assets/codeEdit.css"/>

<script src="../../assets/jquery.js"></script>
<script src="../../assets/paper.js"></script>
<script src="../../assets/codemirror.js"></script>
<script src="../../assets/scripts.js"></script>    
    
</head>
<body>

<div id="nav">
    <a href="/">
        <!--          <h1>web-cgal</h1>-->
            <img id="logo" width ="100px" height ="100px" src="../../logo.svg"/>
    </a>

  <ul class="menu-root">
    <li><a data-default="true" href="/">Home</a>
    </li>
</ul>
  <ul class = "menu-root">
        <li class=""><a href="/index.html#features" class="">Features</a>  
        </li>
      
        <li class=""><a href="/index.html#browsersupport" class="">Browser support</a>
        </li>    
    </ul>
    
    <ul class = "menu-root">
        <li><a class="active" href="/playground.html">Playground</a>
        </li>
     </ul>
    
    <ul class="menu-root">
        <li><a href="/examples" class="">Examples</a>
        </li>
    </ul>
    
    
</div>
    
    <article>
        

    

        
<!--
<pre class="code" start="3">
    var myPath = new Path();
    myPath.add(myPoint);
</pre>
-->

<!--        <div class="paperscript">-->        
<div class="paperscript split">  
    
<div class="canvas up">
    <div class="left-div">
        <canvas width="600px" height="420px" id="canvas-1"></canvas>
    </div>
    <div class = "right-div" id="console">
        &nbsp;
    </div>
</div>
    
    
<div class="buttons">
<div class="button run">Source</div>
</div>
<script type="text/paperscript" canvas="canvas-1">
var colors = ['red', 'blue', 'yellow', 'magenta', 'green'];
var drawables = [], segment = null, path = null, polPoint = null, polygon = null;
var hitOptions = {segments: true, fill: true, stroke: true, tolerance: 10};

function onMouseMove(event) { 
	project.activeLayer.selected = false;
    //if (event.item)
      //  event.item.bringToFront();
}

function onMouseDown(event) { 

    segment = path = polPoint =  null;
    
	var hitResult = project.hitTest(event.point, hitOptions);
    if (hitResult){                                               //console.log(event.item.name)
        if(event.item.name == 'polygon')
            path = hitResult.item;
        else if (event.item.name.startsWith('polygonPoint'))
        {
            res = event.item.name.split('-')
            polPoint = event.item;
        }
        else if (hitResult.type == 'segment')
            segment = hitResult.segment;
    }
}

function onMouseDrag(event) {     
    if (segment)
		segment.point += event.delta;
	else if (path)
        polygon.changePosition(event.delta);
    if (polPoint)
        polygon.changePosition2(polPoint, event.delta);
 }

////////////////////////////////////     Visual Part      ///////////////////////////////

function clearDrawables(){
    for(i=0; i<drawables.length; i++) // it is for lines, circles, texts etc.
        drawables[i].remove();
    PolygonPoint.counter = 0;
}

Array.prototype.clear = function() {
  while (this.length) 
    this.pop();
};

//////////////////////////////////////  Classes  ////////////////////////////////////////

function Polygon(){

    this.points = [];
    this.path = null;
    
    this.addPoint = function(p){
        this.points.push(new PolygonPoint(p));  
    }
        
    this.getPoint = function(name){
        for(var i=0; i<this.points.length; i++)
            if(this.points[i].path.name == name)
                return this.points[i];
    }
    
    this.changePosition = function(delta){
        for(var i=0; i < this.points.length; i++)
            this.points[i].pos += delta;
            
        this.draw();
    }
    
    this.changePosition2 = function(polPoint, delta){
    
        var res = polygon.getPoint(polPoint.name);
        res.pos += delta;        
    
        this.draw();
    }
    
    this.draw = function(){ // silip tekrar cizdirir
        clearDrawables();
        for(var i=0; i<this.points.length; i++)
            this.points[i].draw(i);  
            
        this.path = new Path({name: 'polygon', fillColor: 'white', strokeColor: 'black', strokeWidth: 2});
        this.path.sendToBack();
        this.path.closed = true;
        
        for(var i=0; i < this.points.length; i++)
            this.path.add(this.points[i].pos);
        
        drawables.push(this.path);
    };
    
    this.sort = function(){
    
        this.points.sort(function(a, b) {return a.point.x - b.point.x;});
    
    }
};

function PolygonPoint(p){

    this.pos = p;
    this.path = null;
    
    var tempObj = this;
    
    this.draw = function(id){
        drawables.push(new PointText({ point: this.pos + [5, -5], fontSize: '16px', fillColor: 'black', content: ' '+ id}));
        
        tempObj.path = new Path.Circle({ name: 'polygonPoint-'+id, center: this.pos, radius: 5, fillColor: 'black'});
        drawables.push(tempObj.path);
    };
    
    this.toString = function dogToString() {
        return ''+this.pos;  
    };
};

function createRandomPolygon(){ 

    var sel = Math.floor(Math.random() * 3)
    var polygons = [
                    [[350.5,104],[300.5,231],[326.5,359],[236.5,335],[37.5,194],[181.5,161],[257.5,57]],
                    [[401.5,104],[450.5,246],[386.5,379],[236.5,335],[97.5,194],[287.5,222],[257.5,57]],
                    [[432.5,100],[481.5,242],[417.5,375],[267.5,331],[128.5,190],[200.5,90],[288.5,53]]
                   ];
                              
    var pols = polygons[sel];                
    var polygon = new Polygon();
    
    for(var k=0; k < pols.length; k++)
        polygon.addPoint(new Point(pols[k]));
    
    return polygon;
}

function createCodeMirror2(place, options, source) {

	return new CodeMirror(place, $.extend({}, {
		mode: 'javascript',
		tabSize: 4, indentUnit: 2, readOnly: true,
		value: source.match(
			// Remove first & last empty line
			/^\s*?[\n\r]?([\u0000-\uffff]*?)[\n\r]?\s*?$/)[1]
	}, options));
}

logStr = '';
function print(str){

    logStr = logStr.concat(str+'\n');

    var place = document.getElementById("console");
    $(place.childNodes[1]).remove()
    editor = createCodeMirror2(place, {}, logStr);   
}

function clear(){

    logStr = '';

    var place = document.getElementById("console");
    $(place.childNodes[1]).remove()
    editor = createCodeMirror2(place, {}, logStr);   
}

var origin = new Point(300, 210);

function convertToRealCoord(p){
    var temp = p.clone();
    temp *= 60;
    temp += new Point(300, 210);
    temp.y = 600 - temp.y;
    
    //console.log(temp);
    return temp;
}

function drawCoordinateSystem(){ 
    new Path.Line({name: 'x-coord', from: [0, origin.y], to:[600, origin.y], strokeColor:'black', strokeWidth: 2})
    new Path.Line({name: 'y-coord', from: [origin.x, 0], to:[origin.x, 420], strokeColor:'black', strokeWidth: 2})
    
    for(i = -7; i <= 10; i++)
       new Path.Line({name: 'coord', from: convertToRealCoord(new Point(-7, i)), to: convertToRealCoord(new Point(7, i)), strokeColor:'black', strokeWidth: 1, dashArray: [1,2]})
 
    for(i = -7; i <= 7; i++)
       new Path.Line({name: 'coord', from: convertToRealCoord(new Point(i, -7)), to: convertToRealCoord(new Point(i, 7)), strokeColor:'black', strokeWidth: 1, dashArray: [1,2]})  
}

//end-script
drawCoordinateSystem();

var polygon = createRandomPolygon(); // first create a random polygon, then modify by dragging
//polygon.sort();
polygon.draw();

function onMouseMove(){
	clear();
	for(var i=0; i<polygon.points.length; i++)
    	print("Point-"+i+": " + polygon.points[i])
}





// end of script

</script>

   
</div>
        
</article>    


    
</body>

<script>

//function createCodeMirror2(place, options, source) {
//	return new CodeMirror(place, $.extend({}, {
//		mode: 'javascript',
//		tabSize: 4, indentUnit: 4, readOnly: true,
//		value: source.match(
//			// Remove first & last empty line
//			/^\s*?[\n\r]?([\u0000-\uffff]*?)[\n\r]?\s*?$/)[1]
//	}, options));
//}
//
//var deneme = `var pols = polygons[sel];                
//var polygon = new Polygon();
//`;    
//    
//var place = document.getElementById("console");
//editor = createCodeMirror2(place, {}, deneme);   
//    
//    
   
    
</script>


</html>

